<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mood Mirror - Prototype</title>
</head>
<body>
<img id="photo" src="" width="50%"><br/>
<img id="moodUrl" src="">
<section id="face-detection">

</section>

<!--Loading jquery library-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery-1.11.3.min.js"><\/script>')</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script>

</script>

<script>
    //start of function
    $(function() {
        var emotion = ""; //Create empty variable to store emotion generated by API
        //var photo = 'http://glamoursmiles.com/wp-content/uploads/2013/03/Smile-Head-Tilt.jpg'; //Create variable for the photo that will be added later on
        var photo = 'http://kingofwallpapers.com/angry/angry-002.jpg';
        document.getElementById('photo').src = photo; //add photo url to the img tag in html for preview purposes
        var params = {
            // Request parameters
        };

        //start of face scanner API
        $.ajax({
            url: "https://westus.api.cognitive.microsoft.com/emotion/v1.0/recognize" + $.param(params),
            beforeSend: function(xhrObj){
                // Request headers
                xhrObj.setRequestHeader("Content-Type","application/json");
                xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key","23f48f8d30ad4caf8f1645dc0bdf3e3f");
            },
            type: "POST",
            // Request body with photo URL
            data: "{'url': '"+photo+"'}"

        })
            //If the photo is scanned, store the emotion with the highest value
            .done(function(data) {
                console.log(data);

                for (var i in data[0].scores) {
                    console.log(i + ": " + data[0].scores[i].toFixed(0));
                    if(data[0].scores[i].toFixed(2) == 1){
                        emotion = i;
                    }
                }

                console.log(emotion);

            })
            //If the scanning fails
            .fail(function() {
                alert("error");
            });

            // Combine face api with art api
            var apiEndpointBaseURL = "http://api.harvardartmuseums.org/object";
            var queryString = $.param({
                apikey: "fec9ded0-f7b6-11e6-a459-7b38e8009412",
                title: emotion, //<-- emotion is inserted here
                classification: "Paintings"
            });

            //read the json array from the art API
            $.getJSON(apiEndpointBaseURL + "?" + queryString, function(data) {
                console.log(data);

                var artSrcArray = [];
                //Loop through all the results and keep out the results with empty image url's
                for (var i in data.records) {
                    var artSrc = data.records[i].primaryimageurl;
                    if(artSrc == null){

                    } else {
                        //put all the valid results in an array
                        artSrcArray.push(artSrc);
                    }
                }
                //take a random result from the valid results array and insert it into the img tag
                document.getElementById('moodUrl').src = artSrcArray[Math.floor(Math.random()*artSrcArray.length)];
            });

            console.log(emotion); //check the emotion with the highest value
    });
</script>
</body>
</html>