!function(){"use strict";function a(a,b){function h(){w.fillStyle="#EEE",w.fillRect(0,0,x,y)}function i(a){var b=o.find(a),c=o.find(".url-field");c.width(b.outerWidth(!0)+c.width()),b.hide()}function j(){B.addClass("loading")}function k(){B.removeClass("loading invalid")}function l(a){C.text(a)}function m(a,b){if(j(),0===b.length)l(g.NO_FACE);else for(var c=b.length-1;c>=0;c--){var d,e,f=b[c];"Male"===f.attribute.gender.value?(d="#12BDDC",e="rgba(18,189,220,0.8)"):(d="#C537D8",e="rgba(197,55,216,0.8)");var h=["eye_left","eye_right","mouth_left","mouth_right"];w.fillStyle=d;for(var i=h.length-1;i>=0;i--)w.beginPath(),w.arc(a.offsetX+f[h[i]].x*a.width*.01,a.offsetY+f[h[i]].y*a.height*.01,.01*f.width*6,0,2*Math.PI),w.fill();$("<div/>").css({position:"absolute",top:a.offsetY+.01*(f.center.y-f.height/2)*a.height-5,left:a.offsetX+.01*(f.center.x-f.width/2)*a.width-5,width:f.width*a.width*.01,height:f.height*a.height*.01,border:"5px solid "+d,borderColor:e,borderRadius:"10px"}).qtip({content:"<table><tr><td>width</td><td>"+(.01*f.width).toFixed(2)+"</td></tr><tr><td>height</td><td>"+(.01*f.height).toFixed(2)+"</td></tr><tr><td>center</td><td>("+(.01*f.center.x).toFixed(2)+", "+(.01*f.center.y).toFixed(2)+")</td></tr><tr><td>eye_left</td><td>("+(.01*f.eye_left.x).toFixed(2)+", "+(.01*f.eye_left.y).toFixed(2)+")</td></tr><tr><td>eye_right</td><td>("+(.01*f.eye_right.x).toFixed(2)+", "+(.01*f.eye_right.y).toFixed(2)+")</td></tr><tr><td>mouth_left</td><td>("+(.01*f.mouth_left.x).toFixed(2)+", "+(.01*f.mouth_left.y).toFixed(2)+")</td></tr><tr><td>mouth_right</td><td>("+(.01*f.mouth_right.x).toFixed(2)+", "+(.01*f.mouth_right.y).toFixed(2)+")</td></tr><tr><td>race</td><td>"+f.attribute.race.value+" ("+f.attribute.race.confidence.toFixed(2)+"%)</td></tr><tr><td>age</td><td>"+f.attribute.age.value+" (&#177;"+f.attribute.age.range+")</td></tr><tr><td>gender</td><td>"+f.attribute.gender.value+" ("+f.attribute.gender.confidence.toFixed(2)+"%)</td></tr></table>",style:{classes:"detector-tooltip ui-tooltip-light ui-tooltip-tipify"},position:{my:"bottom center",at:"top center"}}).appendTo(B)}k()}function n(a,b){if(a!==z.src){var i=++A;j(),h(),B.children().remove(),z.onload=function(){var a=Math.min(x/z.width,y/z.height,1),j={width:z.width*a,height:z.height*a,offsetX:(x-z.width*a)/2,offsetY:(y-z.height*a)/2};w.drawImage(z,j.offsetX,j.offsetY,j.width,j.height),c({img:z.src,type:b?"dataURI":"url",success:function(a){if(i===A){var c=d+"detection/detect?api_key="+e+"&api_secret="+f;b||(c+="&url="+encodeURIComponent(z.src)),l(c);var g=JSON.stringify(a,null,"  ");try{Rainbow.color(g,"javascript",function(a){o.find(".result").html(a)})}catch(h){o.find(".result").text(g)}m(j,a.face)}},error:function(){i===A&&(h(),k(),l(g.LOAD_ERROR))}})},z.onerror=function(){h(),k(),B.addClass("invalid"),o.find(".result").html(""),l(g.URL_ERROR)},z.src=a}}for(var o=$(a),p=o.find(".photolist"),q=[],r=0,s=b.imgs.length;s>r;r++){var t=document.createElement("img");t.src=b.imgs[r],t.width=t.height=80,q.push(t)}p.append(q);var u=!1;o.find(".left-paddle").click(function(){u===!1&&(u=!0,p.css({left:"-80px"}).prepend(p.children("img:last-child")).animate({left:0},200,"linear",function(){u=!1}))}),o.find(".right-paddle").click(function(){u===!1&&(u=!0,p.animate({left:"-80px"},200,"linear",function(){p.css({left:0}).append(p.children("img:first-child")),u=!1}))});var v=o.find(".canvas").get(0),w=v.getContext("2d"),x=v.width,y=v.height,z=new Image,A=0,B=o.find(".faces"),C=o.find(".rest-url");if(o.find(".url-field").focus(function(){$(this).select()}).mouseup(function(){return!1}),o.find(".url-form").on("submit",function(){return n($(this).children(".url-field").val()),!1}),p.children("img").click(function(){var a=o.find(".url-field");a.val(this.src),n(this.src)}),navigator.getUserMedia){var D=o.find(".webcam");D&&D.click(function(){return $(".camera-modal").show(),navigator.getUserMedia({video:!0,audio:!1},function(a){var b=$(".camera-modal video").get(0),c=o.find(".camera-modal"),d=function(){$(b).hide(),a.stop(),c.hide(),o.find(".capture").hide(),c.unbind("click")};c.click(d),b.src=window.URL.createObjectURL(a),b.onerror=function(){a.stop(),d()},$([o.find(".capture").get(0),b]).show().unbind("click").click(function(){j();var a=Math.min(x/b.videoWidth,y/b.videoHeight,1),c=document.createElement("canvas");return c.height=b.videoHeight*a,c.width=b.videoWidth*a,c.getContext("2d").drawImage(b,0,0,b.videoWidth*a,b.videoHeight*a),n(c.toDataURL("image/jpeg"),!0),d(),!1})},function(){$(".camera-modal").hide(),l(g.NO_CAMERA),i(".webcam")}),!1})}else i(".webcam");window.FileReader?o.find(".upload-file").change(function(){if(this.files.length>0){j();var a=new FileReader;a.onload=function(){n(a.result,!0)},a.onerror=function(){k(),B.addClass("invalid")},a.readAsDataURL(this.files[0])}}):i(".upload-file-wrapper"),h(),p.children("img:first-child").click()}function b(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;d++)c.push(b.charCodeAt(d));return new Blob([new Uint8Array(c)],{type:"image/jpeg"})}function c(a){if($.support.cors){var c=new XMLHttpRequest;if(c.timeout=1e4,c.onreadystatechange=function(){4===c.readyState&&(200===c.status?a.success(JSON.parse(c.responseText)):a.error())},"url"===a.type)c.open("GET",d+"detection/detect?api_key="+e+"&api_secret="+f+"&url="+encodeURIComponent(a.img),!0),c.send();else if("dataURI"===a.type){c.open("POST",d+"detection/detect?api_key="+e+"&api_secret="+f,!0);var g=new FormData;g.append("img",b(a.img)),c.send(g)}else a.error()}else"url"===a.type?$.ajax({url:d+"detection/detect",data:{api_key:e,api_secret:f,url:a.img},dataType:"jsonp",success:a.success,error:a.error,timeout:1e4}):a.error()}var d="http://api.faceplusplus.com/",e="0df565d6e2a56d30a100686779ada46f",f="hO1Ox6df2oym7QKBb562_VRywxwHBj6d",g={URL_ERROR:"Invalid URL",LOAD_ERROR:"Failed to Load",LOADING:"Loading...",NO_FACE:"No face detected",NO_CAMERA:"No camera available"};window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,$(function(){a(document.getElementById("detector"),{imgs:["http://faceplusplus.com/static/img/demo/1.jpg","http://faceplusplus.com/static/img/demo/2.jpg","http://faceplusplus.com/static/img/demo/3.jpg","http://faceplusplus.com/static/img/demo/4.jpg","http://faceplusplus.com/static/img/demo/5.jpg","http://faceplusplus.com/static/img/demo/6.jpg","http://faceplusplus.com/static/img/demo/7.jpg","http://faceplusplus.com/static/img/demo/8.jpg","http://faceplusplus.com/static/img/demo/9.jpg","http://faceplusplus.com/static/img/demo/10.jpg","http://faceplusplus.com/static/img/demo/11.jpg","http://faceplusplus.com/static/img/demo/12.jpg","http://faceplusplus.com/static/img/demo/13.jpg","http://faceplusplus.com/static/img/demo/14.jpg","http://faceplusplus.com/static/img/demo/15.jpg","http://faceplusplus.com/static/img/demo/16.jpg","http://faceplusplus.com/static/img/demo/17.jpg","http://faceplusplus.com/static/img/demo/18.jpg","http://faceplusplus.com/static/img/demo/19.jpg","http://faceplusplus.com/static/img/demo/20.jpg","http://faceplusplus.com/static/img/demo/21.jpg"]})})}();